C51 COMPILER V9.56.0.0   MAIN                                                              08/01/2018 14:08:11 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\main.obj
COMPILER INVOKED BY: C:\Keil_v5c51\C51\BIN\C51.EXE ..\user\main.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\include) DEBU
                    -G OBJECTEXTEND PRINT(.\main.lst) OBJECT(.\main.obj)

line level    source

   1          #define ALLOCATE_EXTERN
   2          #include "HC89F0650.h"
   3          #include "intrins.h"
   4          #include "Uart.h"
   5          #include "SPI.h"
   6          #include "I2C.h"
   7          #include "QMA6981.h"
   8          #include "MG127.h"
   9          #include "I2C_SLAVE.h"
  10          #include "Test_Prom.h"
  11          
  12          void System_init(void);
  13          void IO_Init();
  14          
  15          void Delay_us(u32 delayCnt)
  16          {
  17   1              u32 temp0 =0;
  18   1              for(temp0 =0; temp0 < delayCnt;temp0++)
  19   1              {
  20   2              _nop_();
  21   2              _nop_();
  22   2              _nop_();
  23   2              _nop_();
  24   2              _nop_();
  25   2              _nop_();
  26   2              }
  27   1      }
  28          
  29          void Delay_ms(u32 delayCnt)
  30          {
  31   1              u32 temp0 =0;
  32   1              for(temp0 =0; temp0 < delayCnt;temp0++)
  33   1              {
  34   2              Delay_us(1132);
  35   2              }
  36   1      }
  37          
  38          
  39          void main(void)
  40          {
  41   1              unsigned short step_num = 0;
  42   1              System_init();                                          //系统初始化
  43   1              IO_Init();                                                      //IO初始化
  44   1              SPI_Init();            //SPI初始化
  45   1              IIC_Init();
  46   1              //ES1 = 1;                                                      //开串口中断
  47   1              EA = 1;                                                         //使能总中断
  48   1      
  49   1              if(qmaX981_get_chip_id())
  50   1              {
  51   2                      qma6981_initialize();
  52   2              }
  53   1              BLE_Init();
  54   1              while(1)
C51 COMPILER V9.56.0.0   MAIN                                                              08/01/2018 14:08:11 PAGE 2   

  55   1              {
  56   2                      //////ble rtx api
  57   2                      //txcnt=100; //txcnt=0 is for rx only application
  58   2                      //rxcnt=20; //rxcnt=0 is for tx only application
  59   2                      //qma6981_read_raw_xyz();
  60   2                      step_num = qmaX981_step_c_read_stepCounter();
  61   2                      BLE_Set_rxtxcnt(100, 20);
  62   2                      BLE_TRX();
  63   2                      //Uart_Send_String("BLE trx done.\r\n");
  64   2      
  65   2                      //delay to set ble tx interval
  66   2                      Delay_ms(100);
  67   2              }
  68   1      }
  69          
  70          /***************************************************************************************
  71            * @说明       系统初始化
  72            *     @参数   无
  73            * @返回值 无
  74            * @注         关闭看门狗以及时钟初始化
  75          ***************************************************************************************/
  76          void System_init(void)
  77          {
  78   1              WDTCCR = 0x00;                                          //关闭看门狗
  79   1      
  80   1              while((CLKCON&0x20)!=0x20);                     //等待内部高频晶振起振
  81   1              CLKDIV = 0x02;                                          //CPU时钟2分频，确保在进行RC32分频时CPU时钟小于16M
  82   1              CLKSWR &=~ 0x10;                                        //切换为内部高频时钟
  83   1              while((CLKSWR&0x40)!=0x00);                     //等待内部高频切换完成
  84   1              CLKDIV = 0x04;                                          //OSC时钟4分频
  85   1      }
  86          
  87          void IO_Init()
  88          {
  89   1              P5M2 = 0x00;
  90   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    305    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
